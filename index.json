[{"content":" ","date":"9 January 2023","permalink":"/","section":"","summary":" ","title":""},{"content":"","date":"9 January 2023","permalink":"/authors/","section":"Authors","summary":"","title":"Authors"},{"content":"","date":"9 January 2023","permalink":"/categories/","section":"Categories","summary":"","title":"Categories"},{"content":"","date":"9 January 2023","permalink":"/categories/defense-evasion/","section":"Categories","summary":"","title":"Defense Evasion"},{"content":"","date":"9 January 2023","permalink":"/tags/kraken/","section":"Tags","summary":"","title":"kraken"},{"content":"","date":"9 January 2023","permalink":"/series/kraken-fundamentals/","section":"Series","summary":"","title":"Kraken Fundamentals"},{"content":" We are starting a new year and with it comes new opportunities and new challenges!\nI want to start this 2023 by presenting a project I have been working on for more than a year. And which will be presented at the next Hackplayers Conference (Hc0n) to be celebrated on February 24 and 25 at La Nave (Madrid).\nTo start with the explanation, first I need to \u0026ldquo;seek at the beginning\u0026rdquo;, where it all started and continue from there.\nThis will be the first in a series of posts where I will talk about Kraken, how it works internally and how it can be used.\nSo, grab a snack and\u0026hellip; let\u0026rsquo;s get started!\nIntroduction\u003e Introduction # During one of my Red Team exercises, I was able to compromise many web platforms of client perimeter. The vulnerability I exploited allowed me to deploy a Webshell1 on each of the compromised servers.\nThe reason why we deploy a Webshell instead of using another vector, is to provide as well an execution vector ( TA0002) as a way to maintain access ( TA0003) to the compromised machine.\nAt this point, I was going to start with the reconnaissance, as I was used to do. However, after sharing the findings with my colleagues, I was warned of the possible existence of EDR’s2 in the compromised servers.\nAs these are machines exposed to Internet (Endpoint3), they should have a stronger Hardening4 policy than other computers in the organization.\nIt was at this point that the first problem appeared to me:\nHow can I verify this premise without attracting attention?\n— (because it\u0026rsquo;s it is highly probable that the command execution was monitored)\nIn order to solve this problem, I quickly implemented a proof-of-concept \u0026ldquo;webshell\u0026rdquo; that would allow me to perform basic operations on the system in order to check it.\nAfter using it on one of the compromised servers, I was able to confirm that there was a Linux agent of a well-known EDR which was in operation.\nThis complicated the situation, since it was known in advance that the product would detect any attempt of enumeration using traditional webshell actions.\nAnd there is where the next question was discussed:\nHow I can do a complete reconnaissance without being detected?\nAnd from the answer to this question, a very minimalist version of what Kraken is today was born.\nWhat is Kraken?\u003e What is Kraken? # Kraken is a tool that allows you to manage webshells in multiple programming languages. Maybe we could say that it is something like a \u0026ldquo;webshells orchestrator\u0026rdquo;.\nHowever, the goal that Kraken follows is: to give you the ability to operate as silent as possible. Using, for this purpose, all resources available by the programming language and the operative system.\nHow does Kraken work?\u003e How does Kraken work? # Kraken\u0026rsquo;s execution flow can be simplified in the following diagram:\nOn the one hand, we have the Kraken\u0026rsquo;s Client which is a Python script that can be used to generate webshells and connect to them once they are deployed.\nAnd on the other hand, the Kraken\u0026rsquo;s Agent with which we get to execute the modules that will allow us to obtain the information we are looking for during the reconnaissance procedure.\nLater on we will go deeper into all these components involved in the operation of the tool and why they are there.\nWhat programming languages does Kraken support?\u003e What programming languages does Kraken support? # Currently, Kraken supports:\nPHP (for PHP web services) Java (for JSP) .NET (for ASPX) Obviously this is only a part of all the web technologies currently available, however, I have chosen these three ones because they are the most common and it allows face the problems that appear during the development.\nThose who cover too much, they obtain too little. — Popular Spanish proverb\nOn the other hand, Kraken agents or webshells have been tested on the following operative systems:\nWindows (different versions) Linux (different distributions) Then, a question that arises (or has been there from the beginning) is the following:\nWhat makes it different from other well-known webshells?\u003e What makes it different from other well-known webshells? # Kraken gathers a set of characteristics that have been designed to improve the use of the tool and provide a different view of the use of webshells. Some of the features that make it different from the other tools are:\nExecution of system commands is prevented (its main feature and the purpose for which it was developed). This property makes it very useful on systems where it exists an active monitoring or with the presence of some security solutions which can detect our movements. Its modular design presents some advantages and strengths against other tools:\nIt allows to maintain a multi-version system with which, is determined at runtime, those modules that can be loaded based on the information reported by the agent with whom it communicates. The hierarchy chosen for the module system allows \u0026ldquo;hot-editing\u0026rdquo; of the modules in use. In the same way, it\u0026rsquo;s possible to register modules without stopping program execution. The development of each module seeks to get the maximum exploitation of the language features to get the best recreation of the commands which have been traced. This tends to generate larger modules but with better results. The templates provided for each language make it easy to extend Kraken\u0026rsquo;s functionality and create new modules. Since modules are managed as files, the use of symbolic links (for cases where the implementation does not vary depending on the version) avoids \u0026ldquo;duplicity\u0026rdquo; of the modules. Kraken provides a Cross-Compiling system without added dependencies that allows, for the cases in which it is necessary, to compile the modules without having to worry about having the requirements installed on the machine. This has been achieved thanks to the integration with Docker5.\nThere are currently two modes of using Kraken:\nThe \u0026ldquo;Standard\u0026rdquo; Mode (ST): which is the traditional way webshells work (request-invoking-response style). The \u0026ldquo;Command-and-Control\u0026rdquo; Mode (C2): whose operation is similar to that of a C2 using the load-invocation-unload method of modules using session variables (to be discussed in detail in future posts). Communication flexibility through the use of connection profiles. It is possible to detail all the information about how the communication between client and agent is going to be from a JSON file that follows a specific schema.\nAdditionally, Kraken also provides utilities such as:\nA pseudo-terminal with basic console capabilities. Error control in Agents, Modules and Client. Integrated Logging and History system. And other utilities related to the tool. Conclusions\u003e Conclusions # This brings us to the end of the first part. In the following posts I will go deeper into the internal structure of Kraken, the elements that influence its operation as well as practical examples of use. So don\u0026rsquo;t miss what comes next!\nI hope you have enjoyed it and see you soon!\nWhat is a Webshell? : https://www.imperva.com/learn/application-security/web-shell/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nWhat is an EDR? : https://www.crowdstrike.com/cybersecurity-101/endpoint-security/endpoint-detection-and-response-edr/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nWhat is an Endpoint? : https://www.paloaltonetworks.com/cyberpedia/what-is-an-endpoint\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nWhat is Hardening? : https://www.beyondtrust.com/resources/glossary/systems-hardening\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nWhat is Docker? : https://www.docker.com/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"9 January 2023","permalink":"/posts/kraken-fundamentals-1/","section":"Posts","summary":"Kraken is a tool for orchestrating webshells developed in PHP, Java and .NET. This is the first post of the Kraken Fundamentals series, where we will talk about how the tool is designed and how it works.","title":"Kraken Fundamentals - I"},{"content":"","date":"9 January 2023","permalink":"/categories/persistence/","section":"Categories","summary":"","title":"Persistence"},{"content":"","date":"9 January 2023","permalink":"/tags/redteam/","section":"Tags","summary":"","title":"redteam"},{"content":"","date":"9 January 2023","permalink":"/authors/secu/","section":"Authors","summary":"","title":"secu"},{"content":"","date":"9 January 2023","permalink":"/series/","section":"Series","summary":"","title":"Series"},{"content":"","date":"9 January 2023","permalink":"/tags/","section":"Tags","summary":"","title":"Tags"},{"content":"","date":"9 January 2023","permalink":"/tags/webshell/","section":"Tags","summary":"","title":"webshell"},{"content":"","date":"9 January 2023","permalink":"/posts/","section":"Posts","summary":"","title":"Posts"},{"content":"My name is Raul Caro Teixido (aka Secu) and I love to develop, research and break all kind of things related with cybersecurity.\nI started in cybersecurity in 2017, when I was in high school and had a lot of time to read and learn. In 2018 I started my first job as a Cybersecurity consultant, and today I have more than 4 years of experience working as a Red Team Analyst (Incide and Blackarrow).\nCurrently, I dedicate my free time to improve/create tools that can be useful in my work, as well as to improve my skills in Red Team. I like to share what I learn because\u0026hellip;\nAre we not the result of what we have learned from others?\nFeel free to contact me at Twitter or LinkedIn.\n","date":"27 December 2022","permalink":"/about/","section":"","summary":"My name is Raul Caro Teixido (aka Secu) and I love to develop, research and break all kind of things related with cybersecurity.\nI started in cybersecurity in 2017, when I was in high school and had a lot of time to read and learn.","title":"About"},{"content":"Since I started in the security world, I have not stopped researching, developing and sharing. Below you will find some of the projects and research to which I have dedicated the most time.\nTools\u003e Tools Logo Title Description Link Kraken A modular multi-language webshell. repository Mistica An open source swiss army knife for arbitrary communication over application protocols. repository Conferences\u003e Conferences Logo Title Type Description Hc0n, 2023 Talk Kraken - A modular multi-language webshell Navaja Negra, 2022 Workshop Design and deploy your own private infrastructure BlackHat Arsenal, 2022 Talk Mística: Anything is a tunnel if you're brave enough - Covert channels for everyone! Bitup Alicante, 2020 Talk Covert Channels with Mistica Others\u003e Others Logo Title Description Link LAB.LOCAL A fictitious example of the design and implementation of an organization's Infrastructure. repository CiberReserva Bitup Alicante 2021 CTF Final Challenge, which simulates a Red Team exercise. repository ","date":"27 December 2022","permalink":"/projects/","section":"","summary":"Since I started in the security world, I have not stopped researching, developing and sharing. Below you will find some of the projects and research to which I have dedicated the most time.","title":"Projects"},{"content":"Experience\u003e Experience Company Link Role Dates Location BlackArrow (Tarlogic) Red Team Operator 10/2021 - 12/2022 Madrid, ES INCIDE Digital Data SL Red Team Operator 02/2019 - 10/2021 Barcelona, ES ZATACA SYSTEMS, S.L Cyber Security Consultant 01/2018 - 10/2018 Elche, ES BitUp Alicante Staff Cybersecurity Community 10/2017 - 10/2021 Alicante, ES Certifications\u003e Certifications Logo Company Certification Date Pentester Academy Certified Red Team Expert (CRTE) 03/2022 Offensive Security Offensive Security Certified Proffesional (OSCP) 07/2021 Education\u003e Education School Link Degree Date International University of La Rioja Computer Engineering 2020 - Present University of Alicante Computer Engineering 2016 - 2020 ","date":"27 December 2022","permalink":"/resume/","section":"","summary":"Experience\u003e Experience Company Link Role Dates Location BlackArrow (Tarlogic) Red Team Operator 10/2021 - 12/2022 Madrid, ES INCIDE Digital Data SL Red Team Operator 02/2019 - 10/2021 Barcelona, ES ZATACA SYSTEMS, S.","title":"Resume"}]